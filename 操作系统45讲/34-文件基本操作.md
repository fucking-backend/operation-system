## 仓库管理：如何实现文件的六大基本操作？

在上一节课中，已经建立了仓库，并对仓库进行了划分，就是文件系统的格式化。有了仓库就需要往里面存取东西，对于我们的仓库来说，就是存取应用程序的文件。

所以这一节我们要给仓库增加一些相关的操作，这些操作主要用于新建、打开、关闭、读写文件，它们也是文件系统的标准功能

### 辅助操作
### 操作根目录文件
### 获取文件名
### 判断文件是否存在

### 文件相关操作
### 新建文件

1. 从文件路径名中提取出纯文件名，检查储存设备上是否已经存在这个文件。
2. 分配一个空闲的逻辑储存块，并在根目录文件的末尾写入这个新建文件对应的 rfsdir_t 结构。
3. 在一个新的 4KB 大小的缓冲区中，初始化新建文件对应的 fimgrhd_t 结构。
4. 把第 3 步对应的缓冲区里的数据，写入到先前分配的空闲逻辑储存块中。

### 删除文件

1. 从文件路径名中提取出纯文件名。
2. 获取根目录文件，从根目录文件中查找待删除文件的 rfsdir_t 结构，然后释放该文件占用的逻辑储存块。
3. 初始化与待删除文件相对应的 rfsdir_t 结构，并设置 rfsdir_t 结构的类型为 RDR_DEL_TYPE。
4. 释放根目录文件。

### 打开文件

1. 从 objnode_t 结构的文件路径提取文件名。
2. 获取根目录文件，在该文件中搜索对应的 rfsdir_t 结构，看看文件是否存在。
3. 分配一个 4KB 缓存区，把该文件对应的 rfsdir_t 结构中指向的逻辑储存块读取到缓存区中，然后释放根目录文件。
4. 把缓冲区中的 fimgrhd_t 结构的地址，保存到 objnode_t 结构的 on_finode 域中。

### 读写文件

1. 检查 objnode_t 结构中用于存放文件数据的缓冲区及其大小。
2. 检查 imgrhd_t 结构中文件相关的信息。
3. 把文件的数据读取到 objnode_t 结构中指向的缓冲区中。

### 关闭文件
### 串联整和
### 测试
### 思考题
### question