## 仓库结构：如何组织文件?

### 什么是文件系统
### 文件系统设计

1. 文件系统为什么可以是一个设备开始，以及它在整个 Cosmos 内核中的位置格局？
2. 文件数据的格式以及储存介质的最小单位是什么？
3. 如何组织越来越多的文件。

### 文件系统只是一个设备

1. 文件系统组件是独立的与内核分开的；
2. 操作系统需要动态加载和删除不同的文件系统组件，这样就可以适应复杂的情况了。

![文件系统架构](./32_01.png)

你还记得前面 Cosmos 内核的设备驱动的设计吗？如果文件系统也是 Cosmos 内核下的一个设备，那就好办多了，因为不同的设备驱动程序可以动态加载，而且可以建立多个文件系统设备，而对各个文件系统设备驱动程序的实现，就是各个文件系统的实现。

### 文件格式与存储快

文件系统把文件数据定义成一个动态的线性字节数组，可是一开始我们不知道这个数组是多大，需要分配多少个物理储存块，最好是把这个动态的线性字节数组分成一个个数据块。

然而，不同的储存设备的物理储存块的大小不同，有的是 512 字节，而有的是 4096 字节，我们为了文件系统能工作在不同的储存设备上，所以我们把这里的数据块定义为文件系统逻辑块，其大小为 4096 字节，最后把这个逻辑块映射到一个或多个物理储存块。

![文件逻辑块映射](./32_02.png)


### 如何组织文件（目录）

文件数量多了就出现了目录，而目录是用来帮助用户组织或归纳文件的

### 文件系统数据结构
### 超级块

一个文件系统有很多重要的信息，例如文件系统标识、版本、状态，储存介质大小，文件系统逻辑储存块大小，位图所在的储存块，还有根目录等。因为这些信息很重要，没有它们就等于没有文件系统，所以包含这些信息的数据结构，就叫做文件系统的超级块或者文件系统描述块。

### 位图

怎么来标识哪些逻辑储存块是空闲的，哪些逻辑储存块是已经分配占用的呢？

![位图块](./32_03.png)

### 文件目录

![目录结构](./32_04.png)

### 文件管理头（类似于inode）

### 总结

1. 我们一起了解了什么是文件系统，就是解决如何把许多进程产生的数据——文件，储存在某一种储存设备之上，让进程十分方便就能对各个文件进行相应的操作。
2. 我们设计了自己的文件系统，它在 Cosmos 中就是一个设备，规划了文件系统的文件格式和如何储存文件，还有如何组织多个文件。
3. 我们把文件系统设计变成了对应数据结构，它们分别是描述文件系统信息的超级块、解决逻辑储存块分配状态的位图，还有用文件管理的目录和文件管理头。

### 思考题

我们文件系统的储存单位为什么要自定义一个逻辑储存块？

### question

1. rfssublk_t 超级块
2. rfsdir_t 目录文件
3. fimgrhd_t 文件管理头（类似于inode）