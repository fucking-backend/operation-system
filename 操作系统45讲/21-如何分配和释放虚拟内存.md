## 如何分配和释放虚拟内存？

### 虚拟地址空间的分配和释放

整个虚拟地址空间就是由一个个虚拟地址区间组成的。分配一个虚拟地址空间就是在整个虚拟地址空间分割出一个区域，而释放一块虚拟地址空间，就是把这个区域合并到整个虚拟地址空间中去。

### 虚拟地址空间分配接口

分配虚拟地址空间应该有大小、有类型、有相关标志，还有从哪里开始分配等信息。

### 分配时查找虚拟地址区间
### 虚拟地址空间释放接口
### 释放时查找虚拟地址区间

### 测试环节：虚拟空间能正常访问么？
### 准备工作
### 异常情况与原因分析
### 处理缺页异常核心

首先，查找缺页地址对应的 kmvarsdsc_t 结构，没找到说明没有分配该虚拟地址空间，那属于非法访问不予处理；然后，查找 kmvarsdsc_t 结构下面的对应 kvmemcbox_t 结构，它是用来挂载物理内存页面的；最后，分配物理内存页面并建立 MMU 页表映射关系。

### 缺页地址是否合法
### 建立 kvmemcbox_t 结构
### 映射物理内存页
### 思考题

请问，x86 CPU 的缺页异常，是第几号异常？缺页的地址保存在哪个寄存器中？

### question

