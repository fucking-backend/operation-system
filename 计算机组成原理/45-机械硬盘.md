## 机械硬盘：Google早期用过的“黑科技”

### 机械硬盘组成

**为什么它的 IOPS 是 100 左右**

【悬臂】，【磁头】，【盘面】，【磁道】，【扇区】，【柱面】

进行一次硬盘上的随机访问，需要的时间由两个部分组成：

1. 平均延时（Average Latency）。这个时间，其实就是把我们的盘面旋转，把几何扇区对准悬臂位置的时间。7200 转的硬盘，那么一秒里面，就可以旋转 240 个半圈。那么，这个平均延时就是： 1s / 240 = 4.17ms
2. 平均寻道时间（Average Seek Time），也就是在盘面选转之后，我们的悬臂定位到扇区的的时间。我们现在用的 HDD 硬盘的平均寻道时间一般在 4-10ms。

这样，我们就能够算出来，如果随机在整个硬盘上找一个数据，需要 8-14 ms。我们的硬盘是机械结构的，只有一个电机转轴，也只有一个悬臂，所以我们没有办法并行地去定位或者读取数据。那一块 7200 转的硬盘，我们一秒钟随机的 IO 访问次数，也就是

> 1s / 8 ms = 125 IOPS 或者 1s / 14ms = 70 IOPS

### Partial Stroking：根据场景提升性能

有什么办法，能提高机械硬盘的 IOPS 呢？还真的有。这个方法，就叫作 Partial Stroking 或者 Short Stroking。

其实这个方法的思路很容易理解，我一说你就明白了。既然我们访问一次数据的时间，是“平均延时 + 寻道时间”，那么只要能缩短这两个之一，不就可以提升 IOPS 了吗？

一般情况下，硬盘的寻道时间都比平均延时要长。那么我们自然就可以想一下，有什么办法可以缩短平均的寻道时间。最极端的办法就是我们不需要寻道，也就是说，我们把所有数据都放在一个磁道上。比如，我们始终把磁头放在最外道的磁道上。这样，我们的寻道时间就基本为 0，访问时间就只有平均延时了。那样，我们的 IOPS，就变成了

1s / 4ms = 250 IOPS

不过呢，只用一个磁道，我们能存的数据就比较有限了。这个时候，可能我们还不如把这些数据直接都放到内存里面呢。所以，实践当中，我们可以只用 1/2 或者 1/4 的磁道，也就是最外面 1/4 或者 1/2 的磁道。这样，我们硬盘可以使用的容量可能变成了 1/2 或者 1/4。但是呢，我们的寻道时间，也变成了 1/4 或者 1/2，因为悬臂需要移动的“行程”也变成了原来的 1/2 或者 1/4，我们的 IOPS 就能够大幅度提升了。

### 思考题
### question

机械硬盘分区是由外到内的，C盘在最外侧依次类推，所以机械硬盘里面C盘的性能是所有分区里最好的。
要想只用最外侧1/4的磁道，只需要简单地把C盘分成整个硬盘1/4的容量，剩下的容量弃而不用就可以达到文章里面的效果了！