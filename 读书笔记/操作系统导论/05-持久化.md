## 持久化

### IO设备

分层架构：根据设备性能高低，编排设备。

标准设备：分为硬件接口（寄存器：状态，命令，数据），内部结构

标准协议：

    （1）轮询设备
    （2）OS下发数据到数据寄存器
    （3）OS将命令写入命令寄存器
    （4）OS进行设备轮询

利用中断减少CPU轮询开销：设备完成自身操作，会抛出一个硬件中断，引发CPU跳转执行操作系统预先定义好的中断服务例程

中断并非总比PIO（编程的IO）好：

    （1）设备非常快。轮询反而更好
    （2）速度未知，时快时慢。先轮询，再使用中断
    （3）网络，可能引发活锁。
    （4）多次中断合并为一次中断

利用DMA（协调数据在内存和设备之间传输，不需要CPU介入）进行更高效的数据传输

设备交互的方法：

    （1）明确的IO指令
    （2）内存映射IO

纳入操作系统：设备驱动

question: 键盘敲入“A”字母时，操作系统期间发生了什么

### 磁盘驱动器

磁道，磁头，机械臂

磁盘延迟延迟：

    单慈道延迟：旋转延迟
    多磁道：寻道时间
    IO时间

磁道缓冲区。应该在数据放入内存之后（后写缓存），还是写入实际磁盘之后（直写），回报写入完成

### 磁盘调度算法（🔥🔥🔥）

    （1）先来先服务
    （2）最短寻道时间优先，最短定位时间优先
    （3）SCAN电梯算法（一头走到一头），C-SCAN（改进版，返回的时候不处理）
    （4）LOOK走到最远的的请求（不是走到头），C-LOOK（改进版，返回的时候不处理）


### 廉价冗余磁盘阵列

评估RAID：容量，性能，可靠性

RAID0级（条带化），RAID1级（镜像），RAID4/5级（基于奇偶校验）


### 文件和目录

文件操作：创建文件，读写文件，顺序操作/随机操作，异步/同步操作，重命名，获取文件信息，删除文件

目录操作：创建目录，读取目录，删除目录，**硬链接，符号链接**

### 文件系统实现（🔥🔥🔥）

文件系统的心智模型（真正想要学习发展的东西）：磁盘上那些结构存储文件系统的数据和源数据？当一个进程打开一个文件时会发生什么？在读取或者写入期间访问那些磁盘结构？磁盘需要什么结构？他们需要记录什么？它们如何访问？ 【数据结构，访问方法】


### 局部性和快速文件系统（FFS）

### 崩溃一致性解决方案（🔥🔥🔥）

【文件系统检查程序】

【预写日志（WAL）】

### 日志结构文件系统








